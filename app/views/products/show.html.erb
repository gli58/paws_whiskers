<%= render 'shared/breadcrumbs' do %>
  <% if @product.categories.any? %>
    <li class="breadcrumb-item">
      <%= link_to @product.categories.first.name, category_path(@product.categories.first) %>
    </li>
  <% end %>
  <li class="breadcrumb-item active"><%= @product.name %></li>
<% end %>

<div class="row mt-4">
  <div class="col-md-6">
    <% if @product.image.attached? %>
      <%= image_tag @product.image.variant(:large), class: 'img-fluid rounded', alt: @product.name %>
    <% else %>
      <%
        # Generate different colors for different products
        colors = [
          { bg: 'e3f2fd', text: '1976d2' }, # Blue
          { bg: 'fff3e0', text: 'e65100' }, # Orange
          { bg: 'f3e5f5', text: '7b1fa2' }, # Purple
          { bg: 'e8f5e9', text: '2e7d32' }, # Green
          { bg: 'fce4ec', text: 'c2185b' }, # Pink
          { bg: 'fff9c4', text: 'f57f17' }, # Yellow
          { bg: 'e0f2f1', text: '00695c' }, # Teal
          { bg: 'fbe9e7', text: 'bf360c' }  # Deep Orange
        ]
        color_scheme = colors[@product.id % colors.length]
        short_name = @product.name.split(' ')[0..2].join('+')
      %>
      <%= image_tag "https://placehold.co/800x600/#{color_scheme[:bg]}/#{color_scheme[:text]}?text=#{ERB::Util.url_encode(short_name)}",
                    class: 'img-fluid rounded',
                    alt: @product.name %>
    <% end %>
  </div>

  <div class="col-md-6">
    <h1><%= @product.name %></h1>

    <div class="badges mb-3">
      <% if @product.on_sale %>
        <span class="badge bg-danger">ON SALE</span>
      <% end %>
      <% if @product.is_new %>
        <span class="badge bg-info">NEW</span>
      <% end %>
    </div>

    <h2 class="text-success mb-4"><%= number_to_currency(@product.current_price) %></h2>

    <p class="lead"><%= @product.description %></p>

    <div class="mb-3">
      <strong>Stock:</strong>
      <% if @product.stock_quantity > 0 %>
        <span class="text-success"><%= @product.stock_quantity %> available</span>
      <% else %>
        <span class="text-danger">Out of stock</span>
      <% end %>
    </div>

    <div class="mb-4">
      <strong>Categories:</strong>
      <%= @product.categories.map { |c| link_to c.name, category_path(c), class: 'badge bg-secondary text-decoration-none' }.join(' ').html_safe %>
    </div>

    <% if @product.stock_quantity > 0 %>
      <%= button_to "Add to Cart", add_to_cart_path(@product), method: :post, class: "btn btn-primary btn-lg" %>
    <% else %>
      <button class="btn btn-secondary btn-lg" disabled>Out of Stock</button>
    <% end %>

    <%= link_to "Back to Products", products_path, class: "btn btn-outline-secondary ms-2" %>
  </div>
</div>